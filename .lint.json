[{"filePath":"/Users/ryan/Desktop/Coding/Production/Navigator/src/components/ViewTransition.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n/Users/ryan/Desktop/Coding/Production/Navigator/src/components/ViewTransition.tsx:24:13\n  22 |         if (viewKey !== currentKeyRef.current) {\n  23 |             // viewKey changed — trigger re-animation\n> 24 |             setIsVisible(false);\n     |             ^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  25 |             currentKeyRef.current = viewKey;\n  26 |             const timer = setTimeout(() => setIsVisible(true), 50);\n  27 |             return () => clearTimeout(timer);","line":24,"column":13,"nodeType":null,"endLine":24,"endColumn":25}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useRef, useState } from 'react';\n\ninterface ViewTransitionProps {\n    children: React.ReactNode;\n    viewKey: string; // Changes when view changes, triggering re-animation\n    className?: string;\n}\n\n/**\n * Wraps content with a subtle entrance animation.\n * Uses opacity + slight blur for a modern, non-PowerPoint feel.\n */\nexport const ViewTransition: React.FC<ViewTransitionProps> = ({\n    children,\n    viewKey,\n    className = ''\n}) => {\n    const [isVisible, setIsVisible] = useState(false);\n    const currentKeyRef = useRef(viewKey);\n\n    useEffect(() => {\n        if (viewKey !== currentKeyRef.current) {\n            // viewKey changed — trigger re-animation\n            setIsVisible(false);\n            currentKeyRef.current = viewKey;\n            const timer = setTimeout(() => setIsVisible(true), 50);\n            return () => clearTimeout(timer);\n        } else {\n            // Initial mount\n            const timer = setTimeout(() => setIsVisible(true), 10);\n            return () => clearTimeout(timer);\n        }\n    }, [viewKey]);\n\n    return (\n        <div\n            className={`transition-all duration-200 ease-out ${className} ${isVisible\n                ? 'opacity-100 blur-0 translate-y-0'\n                : 'opacity-0 blur-[2px] translate-y-1'\n                }`}\n        >\n            {children}\n        </div>\n    );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/ryan/Desktop/Coding/Production/Navigator/src/components/edu/CourseEditModal.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n/Users/ryan/Desktop/Coding/Production/Navigator/src/components/edu/CourseEditModal.tsx:25:13\n  23 |     useEffect(() => {\n  24 |         if (isOpen) {\n> 25 |             setEditedCourse(course);\n     |             ^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  26 |             setConfirmDelete(false);\n  27 |         }\n  28 |     }, [course, isOpen]);","line":25,"column":13,"nodeType":null,"endLine":25,"endColumn":28}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { X, Save, Trash2, AlertCircle } from 'lucide-react';\nimport type { Course } from '../../types';\n\ninterface CourseEditModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n    course: Course;\n    onSave: (updatedCourse: Course) => void;\n    onDelete: () => void;\n}\n\nexport const CourseEditModal: React.FC<CourseEditModalProps> = ({\n    isOpen,\n    onClose,\n    course,\n    onSave,\n    onDelete\n}) => {\n    const [editedCourse, setEditedCourse] = useState<Course>(course);\n    const [confirmDelete, setConfirmDelete] = useState(false);\n\n    useEffect(() => {\n        if (isOpen) {\n            setEditedCourse(course);\n            setConfirmDelete(false);\n        }\n    }, [course, isOpen]);\n\n    if (!isOpen) return null;\n\n    const handleSave = () => {\n        onSave(editedCourse);\n        onClose();\n    };\n\n    return (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-neutral-900/50 backdrop-blur-sm\">\n            <div className=\"bg-white dark:bg-neutral-900 rounded-3xl shadow-2xl w-full max-w-md border border-neutral-200 dark:border-neutral-800 overflow-hidden animate-in fade-in zoom-in-95 duration-200\">\n                {/* Header */}\n                <div className=\"px-6 py-4 border-b border-neutral-100 dark:border-neutral-800 flex justify-between items-center bg-neutral-50/50 dark:bg-neutral-800/50\">\n                    <h3 className=\"font-black text-lg text-neutral-900 dark:text-white\">Edit Course</h3>\n                    <button onClick={onClose} className=\"p-2 hover:bg-neutral-200 dark:hover:bg-neutral-700 rounded-full transition-colors text-neutral-500\">\n                        <X className=\"w-5 h-5\" />\n                    </button>\n                </div>\n\n                {/* Body */}\n                <div className=\"p-6 space-y-5\">\n                    {/* Course Code & Title */}\n                    <div className=\"grid grid-cols-3 gap-4\">\n                        <div className=\"col-span-1 space-y-1\">\n                            <label className=\"text-[10px] font-black uppercase tracking-widest text-neutral-500 pl-1\">Code</label>\n                            <input\n                                type=\"text\"\n                                value={editedCourse.code}\n                                onChange={(e) => setEditedCourse({ ...editedCourse, code: e.target.value })}\n                                className=\"w-full px-3 py-2 bg-neutral-50 dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-xl font-mono text-sm font-bold focus:ring-2 focus:ring-indigo-500 outline-none\"\n                            />\n                        </div>\n                        <div className=\"col-span-2 space-y-1\">\n                            <label className=\"text-[10px] font-black uppercase tracking-widest text-neutral-500 pl-1\">Title</label>\n                            <input\n                                type=\"text\"\n                                value={editedCourse.title}\n                                onChange={(e) => setEditedCourse({ ...editedCourse, title: e.target.value })}\n                                className=\"w-full px-3 py-2 bg-neutral-50 dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-xl text-sm font-bold focus:ring-2 focus:ring-indigo-500 outline-none\"\n                            />\n                        </div>\n                    </div>\n\n                    {/* Numeric Grade & Letter Grade */}\n                    <div className=\"grid grid-cols-2 gap-4\">\n                        <div className=\"space-y-1\">\n                            <label className=\"text-[10px] font-black uppercase tracking-widest text-neutral-500 pl-1\">Grade</label>\n                            <input\n                                type=\"text\"\n                                value={editedCourse.grade}\n                                onChange={(e) => setEditedCourse({ ...editedCourse, grade: e.target.value })}\n                                className=\"w-full px-3 py-2 bg-neutral-50 dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-xl text-sm font-black focus:ring-2 focus:ring-indigo-500 outline-none\"\n                            />\n                        </div>\n                        <div className=\"space-y-1\">\n                            <label className=\"text-[10px] font-black uppercase tracking-widest text-neutral-500 pl-1\">Credits</label>\n                            <input\n                                type=\"number\"\n                                step=\"0.5\"\n                                value={editedCourse.credits || 0.5}\n                                onChange={(e) => setEditedCourse({ ...editedCourse, credits: parseFloat(e.target.value) })}\n                                className=\"w-full px-3 py-2 bg-neutral-50 dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-xl text-sm font-bold focus:ring-2 focus:ring-indigo-500 outline-none\"\n                            />\n                        </div>\n                    </div>\n\n                    {/* Delete Warning */}\n                    {confirmDelete ? (\n                        <div className=\"p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl flex items-center justify-between animate-in fade-in slide-in-from-top-2\">\n                            <div className=\"flex items-center gap-3\">\n                                <AlertCircle className=\"w-5 h-5 text-red-600 dark:text-red-400\" />\n                                <span className=\"text-xs font-bold text-red-700 dark:text-red-300\">Confirm deletion?</span>\n                            </div>\n                            <div className=\"flex gap-2\">\n                                <button\n                                    onClick={() => setConfirmDelete(false)}\n                                    className=\"px-3 py-1.5 text-xs font-bold text-neutral-500 hover:bg-white rounded-lg transition-colors\"\n                                >\n                                    Cancel\n                                </button>\n                                <button\n                                    onClick={onDelete}\n                                    className=\"px-3 py-1.5 text-xs font-bold bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors shadow-lg shadow-red-500/20\"\n                                >\n                                    Delete\n                                </button>\n                            </div>\n                        </div>\n                    ) : (\n                        <div className=\"flex justify-start\">\n                            <button\n                                onClick={() => setConfirmDelete(true)}\n                                className=\"text-xs font-bold text-red-500 flex items-center gap-2 hover:bg-red-50 dark:hover:bg-red-900/20 px-3 py-2 rounded-lg transition-colors\"\n                            >\n                                <Trash2 className=\"w-4 h-4\" />\n                                Remove Course\n                            </button>\n                        </div>\n                    )}\n                </div>\n\n                {/* Footer */}\n                <div className=\"p-6 bg-neutral-50 dark:bg-neutral-800/50 border-t border-neutral-100 dark:border-neutral-800 flex justify-end gap-3\">\n                    <button\n                        onClick={onClose}\n                        className=\"px-4 py-2 text-sm font-bold text-neutral-500 hover:text-neutral-900 dark:hover:text-white transition-colors\"\n                    >\n                        Cancel\n                    </button>\n                    <button\n                        onClick={handleSave}\n                        className=\"px-6 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl text-sm font-bold shadow-lg shadow-indigo-500/20 transition-all active:scale-95 flex items-center gap-2\"\n                    >\n                        <Save className=\"w-4 h-4\" />\n                        Save Changes\n                    </button>\n                </div>\n            </div>\n        </div>\n    );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/ryan/Desktop/Coding/Production/Navigator/src/hooks/useHeadlines.ts","messages":[{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\n/Users/ryan/Desktop/Coding/Production/Navigator/src/hooks/useHeadlines.ts:21:46\n  19 |     if (choices !== prevChoices) {\n  20 |         setPrevChoices(choices);\n> 21 |         setActiveHeadline(choices[Math.floor(Math.random() * choices.length)]);\n     |                                              ^^^^^^^^^^^^^ Cannot call impure function\n  22 |     }\n  23 |\n  24 |     return activeHeadline;","line":21,"column":46,"nodeType":null,"endLine":21,"endColumn":59}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useMemo } from 'react';\nimport { HEADLINES } from '../constants';\n\ntype HeadlineType = 'all' | 'apply' | 'goal' | 'edu' | 'plans';\n\ninterface Headline {\n    text: string;\n    highlight: string;\n}\n\nexport const useHeadlines = (type: HeadlineType) => {\n    const choices = useMemo(() => HEADLINES[type], [type]);\n    const [activeHeadline, setActiveHeadline] = useState<Headline>(\n        () => choices[Math.floor(Math.random() * choices.length)]\n    );\n    const [prevChoices, setPrevChoices] = useState(choices);\n\n    // Re-pick when type changes (avoids setState-in-effect)\n    if (choices !== prevChoices) {\n        setPrevChoices(choices);\n        setActiveHeadline(choices[Math.floor(Math.random() * choices.length)]);\n    }\n\n    return activeHeadline;\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/ryan/Desktop/Coding/Production/Navigator/src/modules/features/FeaturesPage.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n/Users/ryan/Desktop/Coding/Production/Navigator/src/modules/features/FeaturesPage.tsx:52:17\n  50 |             hasSetDefaultRef.current = true;\n  51 |             if (userTier !== 'free' && userTier !== 'admin') {\n> 52 |                 setActiveTier(userTier as Tier);\n     |                 ^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  53 |             }\n  54 |         }\n  55 |     }, [user, userTier, isLoading]);","line":52,"column":17,"nodeType":null,"endLine":52,"endColumn":30}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useMemo, useEffect, useRef } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n    Sparkles, PenTool, RefreshCw, Zap, Shield, Bookmark,\n    TrendingUp, Users, FileText, Mail, Rss, Globe,\n    GraduationCap, Search, Calculator, MessageSquare,\n    type LucideIcon,\n} from 'lucide-react';\nimport { BentoCard } from '../../components/ui/BentoCard';\nimport { getAllFeatures, getFeatureColor } from '../../featureRegistry';\nimport { getPreviewComponent } from '../../components/common/FeaturePreviews';\nimport { useUser } from '../../contexts/UserContext';\nimport { useModal } from '../../contexts/ModalContext';\n\n// ─── Types ────────────────────────────────────────────────────────────\n\ntype Tier = 'all' | 'explorer' | 'plus' | 'pro';\n\n// ─── Icon Map ────────────────────────────────────────────────────────\n\nconst ICON_MAP: Record<string, LucideIcon> = {\n    Sparkles, TrendingUp, Zap, FileText, GraduationCap, Bookmark,\n    PenTool, Mail, RefreshCw, Shield, Users, Globe,\n    Search, Calculator, MessageSquare, Rss, School: Search, // School fallback\n};\n\n// ─── Filter Tabs ──────────────────────────────────────────────────────\n\nconst filterTabs: { key: Tier; label: string }[] = [\n    { key: 'all', label: 'All' },\n    { key: 'explorer', label: 'Explorer' },\n    { key: 'plus', label: 'Plus' },\n    { key: 'pro', label: 'Pro' },\n];\n\nconst TIER_LEVEL: Record<Exclude<Tier, 'all'>, number> = { explorer: 0, plus: 1, pro: 2 };\n\n// ─── Page Component ───────────────────────────────────────────────────\n\nexport const FeaturesPage: React.FC = () => {\n    const [activeTier, setActiveTier] = useState<Tier>('all');\n    const hasSetDefaultRef = useRef(false);\n    const navigate = useNavigate();\n    const { user, userTier, isAdmin, isLoading } = useUser();\n    const { openModal } = useModal();\n\n    useEffect(() => {\n        if (!isLoading && !hasSetDefaultRef.current && user) {\n            hasSetDefaultRef.current = true;\n            if (userTier !== 'free' && userTier !== 'admin') {\n                setActiveTier(userTier as Tier);\n            }\n        }\n    }, [user, userTier, isLoading]);\n\n    // Get all features from registry (excluding admin-only for public features page)\n    const allFeatures = useMemo(() => {\n        return getAllFeatures()\n            .filter(f => !f.requiresAdmin || f.isComingSoon)\n            .sort((a, b) => a.rank - b.rank);\n    }, []);\n\n    const filtered = useMemo(() => {\n        if (activeTier === 'all') return allFeatures;\n        const level = TIER_LEVEL[activeTier];\n        return allFeatures.filter(f => TIER_LEVEL[f.tier] <= level);\n    }, [activeTier, allFeatures]);\n\n    const counts = useMemo(() => ({\n        all: allFeatures.length,\n        explorer: allFeatures.filter(f => TIER_LEVEL[f.tier] <= 0).length,\n        plus: allFeatures.filter(f => TIER_LEVEL[f.tier] <= 1).length,\n        pro: allFeatures.filter(f => TIER_LEVEL[f.tier] <= 2).length,\n    }), [allFeatures]);\n\n    return (\n        <div className=\"min-h-screen bg-white dark:bg-[#0a0a0a] py-20 px-4 sm:px-6 overflow-x-hidden\">\n\n            {/* Hero */}\n            <div className=\"max-w-4xl mx-auto text-center mb-16\">\n                <motion.h1\n                    initial={{ opacity: 0, y: 20 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    transition={{ delay: 0.1 }}\n                    className=\"text-4xl md:text-6xl font-extrabold text-neutral-900 dark:text-white tracking-tight mb-6\"\n                >\n                    One platform.{' '}\n                    <span className=\"bg-gradient-to-r from-indigo-500 via-violet-500 to-emerald-500 bg-clip-text text-transparent\">\n                        Every advantage.\n                    </span>\n                </motion.h1>\n                <motion.p\n                    initial={{ opacity: 0, y: 20 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    transition={{ delay: 0.2 }}\n                    className=\"text-lg text-neutral-500 dark:text-neutral-400 max-w-2xl mx-auto leading-relaxed\"\n                >\n                    From your first analysis to your dream offer — here's every tool working behind the scenes to get you there.\n                </motion.p>\n            </div>\n\n            {/* Filter Tabs */}\n            <motion.div\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: 0.3 }}\n                className=\"max-w-7xl mx-auto mb-12\"\n            >\n                <div className=\"flex items-center justify-center\">\n                    <div className=\"relative inline-flex p-1 rounded-full bg-neutral-100 dark:bg-neutral-900 border border-neutral-200/60 dark:border-neutral-800\">\n                        {filterTabs.map(tab => (\n                            <button\n                                key={tab.key}\n                                onClick={() => setActiveTier(tab.key)}\n                                className=\"relative z-10 px-5 py-2 text-sm font-bold rounded-full transition-colors duration-200\"\n                            >\n                                {activeTier === tab.key && (\n                                    <motion.div\n                                        layoutId=\"features-filter-pill\"\n                                        className=\"absolute inset-0 bg-white dark:bg-neutral-800 rounded-full shadow-sm\"\n                                        transition={{ type: 'spring', bounce: 0.2, duration: 0.4 }}\n                                    />\n                                )}\n                                <span className={`relative z-10 flex items-center gap-1.5 ${activeTier === tab.key\n                                    ? 'text-neutral-900 dark:text-white'\n                                    : 'text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-300'\n                                    }`}>\n                                    {tab.label}\n                                    <span className={`text-[10px] tabular-nums ${activeTier === tab.key ? 'text-neutral-400' : 'text-neutral-300 dark:text-neutral-600'}`}>\n                                        {counts[tab.key]}\n                                    </span>\n                                </span>\n                            </button>\n                        ))}\n                    </div>\n                </div>\n            </motion.div>\n\n            {/* Cards Grid */}\n            <div className=\"max-w-7xl mx-auto\">\n                <AnimatePresence mode=\"popLayout\">\n                    <motion.div\n                        key={activeTier}\n                        initial={{ opacity: 0, y: 10 }}\n                        animate={{ opacity: 1, y: 0 }}\n                        exit={{ opacity: 0, y: -10 }}\n                        transition={{ duration: 0.3 }}\n                        className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-6\"\n                    >\n                        {filtered.map((feature) => {\n                            const color = getFeatureColor(feature);\n                            const Icon = ICON_MAP[feature.iconName];\n\n                            const tierLevelMap: Record<string, number> = { free: 0, explorer: 0, plus: 1, pro: 2, admin: 3 };\n                            const userLevel = tierLevelMap[userTier] ?? 0;\n                            const featureLevel = tierLevelMap[feature.tier] ?? 0;\n                            const hasAccess = userLevel >= featureLevel;\n\n                            let actionLabel = feature.action.full;\n                            if (user) {\n                                actionLabel = hasAccess\n                                    ? feature.action.short\n                                    : `Upgrade to ${feature.tier.charAt(0).toUpperCase() + feature.tier.slice(1)}`;\n                            }\n\n                            return (\n                                <motion.div\n                                    key={feature.id}\n                                    layout\n                                    initial={{ opacity: 0, scale: 0.95 }}\n                                    animate={{ opacity: 1, scale: 1 }}\n                                    exit={{ opacity: 0, scale: 0.95 }}\n                                    transition={{ duration: 0.3 }}\n                                >\n                                    <BentoCard\n                                        id={feature.id}\n                                        icon={Icon}\n                                        title={feature.name}\n                                        description={feature.description.full}\n                                        color={color}\n                                        actionLabel={feature.isComingSoon ? \"Coming Soon\" : actionLabel}\n                                        isComingSoon={feature.isComingSoon}\n                                        previewContent={getPreviewComponent(feature.id, color)}\n                                        onAction={() => {\n                                            if (feature.isComingSoon && !isAdmin) {\n                                                // Log interest or show toast\n                                                return;\n                                            }\n                                            if (user) {\n                                                if (hasAccess) {\n                                                    if (feature.link) navigate(feature.link);\n                                                } else {\n                                                    openModal('UPGRADE');\n                                                }\n                                            } else {\n                                                // Guests: Match card navigates to /jobs (has input), others show auth\n                                                if (feature.targetView === 'job-home' && feature.link) {\n                                                    navigate(feature.link);\n                                                } else {\n                                                    openModal('AUTH', { feature });\n                                                }\n                                            }\n                                        }}\n                                    />\n                                </motion.div>\n                            );\n                        })}\n                    </motion.div>\n                </AnimatePresence>\n            </div>\n\n            {/* CTA */}\n            <motion.div\n                initial={{ opacity: 0, y: 30 }}\n                whileInView={{ opacity: 1, y: 0 }}\n                viewport={{ once: true }}\n                transition={{ duration: 0.6 }}\n                className=\"max-w-2xl mx-auto text-center mt-32 mb-12\"\n            >\n                <h2 className=\"text-2xl md:text-3xl font-extrabold text-neutral-900 dark:text-white tracking-tight mb-4\">\n                    Ready to unlock your advantage?\n                </h2>\n                <p className=\"text-sm text-neutral-400 dark:text-neutral-500 mb-8\">\n                    Start with 3 free analyses. No credit card required.\n                </p>\n                <div className=\"flex items-center justify-center gap-4\">\n                    <a\n                        href=\"/plans\"\n                        className=\"px-6 py-3 bg-neutral-900 dark:bg-white text-white dark:text-black text-sm font-bold rounded-xl hover:bg-neutral-800 dark:hover:bg-neutral-200 transition-all shadow-lg shadow-neutral-500/10 active:scale-95\"\n                    >\n                        View Plans\n                    </a>\n                    <a\n                        href=\"/\"\n                        className=\"px-6 py-3 text-sm font-bold text-neutral-500 hover:text-neutral-900 dark:hover:text-white transition-colors\"\n                    >\n                        Try it free →\n                    </a>\n                </div>\n            </motion.div>\n        </div >\n    );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/ryan/Desktop/Coding/Production/Navigator/supabase/functions/gemini-proxy/index.ts","messages":[{"ruleId":"no-control-regex","severity":2,"message":"Unexpected control character(s) in regular expression: \\x08, \\x09, \\x1a, \\x1b.","line":11,"column":37,"nodeType":"Literal","messageId":"unexpected","endLine":11,"endColumn":66}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport { createClient } from \"https://esm.sh/@supabase/supabase-js@2\"\n\nexport const corsHeaders = {\n    'Access-Control-Allow-Origin': '*',\n    'Access-Control-Allow-Headers': 'authorization, x-client-info, apikey, content-type',\n}\n\nconst MAX_LOG_LENGTH = 200;\nconst sanitizeLog = (val: unknown) => {\n    const str = String(val).replace(/[\\n\\r\\t\\0\\x08\\x09\\x1a\\x1b]/g, ' ');\n    return str.length > MAX_LOG_LENGTH ? str.substring(0, MAX_LOG_LENGTH) + '...' : str;\n};\n\nexport const TIER_MODELS: Record<string, { extraction: string; analysis: string }> = {\n    free: {\n        extraction: 'gemini-2.0-flash',\n        analysis: 'gemini-2.0-flash',\n    },\n    plus: {\n        extraction: 'gemini-2.0-flash',\n        analysis: 'gemini-2.0-flash',\n    },\n    pro: {\n        extraction: 'gemini-2.0-flash',\n        analysis: 'gemini-1.5-pro',\n    },\n    admin: {\n        extraction: 'gemini-2.0-flash',\n        analysis: 'gemini-1.5-pro',\n    },\n    tester: {\n        extraction: 'gemini-2.0-flash',\n        analysis: 'gemini-1.5-pro',\n    }\n};\n\nexport const handler = async (req: Request) => {\n    // Handle CORS preflight request\n    if (req.method === 'OPTIONS') {\n        return new Response('ok', { headers: corsHeaders })\n    }\n\n    try {\n        // 1. AUTHORIZATION & USER TIER CHECK\n        const authHeader = req.headers.get('Authorization')\n        if (!authHeader) {\n            throw new Error('Missing Authorization header')\n        }\n\n        const supabase = createClient(\n            Deno.env.get('SUPABASE_URL') ?? '',\n            Deno.env.get('SUPABASE_ANON_KEY') ?? '',\n            { global: { headers: { Authorization: authHeader } } }\n        )\n\n        const { data: { user }, error: authError } = await supabase.auth.getUser()\n        if (authError || !user) {\n            throw new Error('Unauthorized')\n        }\n\n        // Fetch user's subscription tier and flags\n        const { data: profile, error: profileError } = await supabase\n            .from('profiles')\n            .select('subscription_tier, is_admin, is_tester')\n            .eq('id', user.id)\n            .single()\n\n        if (profileError || !profile) {\n            console.error(\"Profile lookup error:\", sanitizeLog(profileError));\n            throw new Error('Failed to retrieve user profile')\n        }\n\n        let userTier = profile.subscription_tier || 'free';\n        if (profile.is_admin) userTier = 'admin';\n        else if (profile.is_tester) userTier = 'tester';\n\n        // 1b. PRE-EXECUTION LIMIT CHECK\n        const { data: limitCheck, error: limitError } = await supabase.rpc('check_analysis_limit', {\n            p_user_id: user.id,\n            p_source_type: 'manual'\n        });\n\n        if (limitError) {\n            console.error(\"Limit check error:\", sanitizeLog(limitError));\n        } else if (limitCheck && !limitCheck.allowed) {\n            return new Response(JSON.stringify({\n                error: \"Limit reached\",\n                reason: limitCheck.reason,\n                used: limitCheck.used,\n                limit: limitCheck.limit\n            }), {\n                headers: { ...corsHeaders, 'Content-Type': 'application/json' },\n                status: 429, // Correct Rate Limit status code\n            });\n        }\n\n        // 2. PARSE REQUEST & RESOLVE MODEL\n        // We no longer trust the client to provide modelName\n        const { payload, task = \"analysis\", generationConfig } = await req.json()\n\n        // Validate task\n        const validTasks = ['extraction', 'analysis'];\n        const safeTask = validTasks.includes(task) ? task : 'analysis';\n\n        const tierConfig = TIER_MODELS[userTier] || TIER_MODELS.free;\n        const modelName = safeTask === 'extraction' ? tierConfig.extraction : tierConfig.analysis;\n\n        console.log(`User ${sanitizeLog(user.id)} (${sanitizeLog(userTier)}) performing ${sanitizeLog(safeTask)} using ${sanitizeLog(modelName)}`);\n\n        // 3. RETRIEVE API KEY\n        const apiKey = Deno.env.get('GEMINI_API_KEY')\n        if (!apiKey) {\n            console.error(\"GEMINI_API_KEY missing in secrets\");\n            throw new Error('GEMINI_API_KEY not set in Edge Function secrets.')\n        }\n\n        // 4. PESSIMISTIC QUOTA INCREMENT\n        let quotaIncremented = false;\n        if (safeTask === 'analysis') {\n            const { error: incError } = await supabase.rpc('increment_analysis_count', {\n                p_user_id: user.id\n            });\n            if (incError) {\n                console.error(\"Analysis increment error:\", sanitizeLog(incError));\n                throw new Error(`Failed to increment analysis quota: ${incError.message}`);\n            }\n            quotaIncremented = true;\n        }\n\n        // 5. CALL GEMINI API VIA FETCH\n        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${apiKey}`;\n\n        let response;\n        try {\n            response = await fetch(apiUrl, {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({\n                    ...payload,\n                    generationConfig,\n                    // Inject a safety rule for all analysis tasks\n                    systemInstruction: safeTask === 'analysis' ? {\n                        role: 'system',\n                        parts: [{ text: \"CRITICAL: First validate if the provided content is a job description or job-related. If it is NOT a job, your entire response must be: {\\\"error\\\": \\\"not_a_job\\\"}. Otherwise, proceed with the requested analysis.\" }]\n                    } : undefined\n                })\n            });\n\n            if (!response.ok) {\n                const errorText = await response.text();\n                throw new Error(`Gemini API Error (${response.status}): ${errorText}`);\n            }\n        } catch (apiError: any) {\n            console.error(\"API execution failure:\", sanitizeLog(apiError.message));\n\n            // REFUND Logic\n            if (quotaIncremented) {\n                const { error: decError } = await supabase.rpc('decrement_analysis_count', {\n                    p_user_id: user.id\n                });\n                if (decError) console.error(\"Refund failed:\", sanitizeLog(decError));\n            }\n            throw apiError; // Re-throw to be caught by main catch block\n        }\n\n        const data = await response.json();\n\n        // Extract text from standard Gemini response structure\n        let text = \"\";\n        if (data.candidates && data.candidates[0] && data.candidates[0].content && data.candidates[0].content.parts) {\n            text = data.candidates[0].content.parts.map((p: { text: string }) => p.text).join('');\n        }\n\n        // 6. CONTENT VALIDATION & REFUND\n        // If the AI returns a \"not_a_job\" flag (which we instruct it to do in prompts), we refund the credit\n        if (safeTask === 'analysis' && (text.includes('\"error\": \"not_a_job\"') || text.includes('not_a_job'))) {\n            console.warn(`Analysis rejected by AI (not a job) for user ${sanitizeLog(user.id)}`);\n            if (quotaIncremented) {\n                const { error: decError } = await supabase.rpc('decrement_analysis_count', {\n                    p_user_id: user.id\n                });\n                if (decError) console.error(\"Refund failed on rejection:\", sanitizeLog(decError));\n            }\n            // Transform to a standard error format the client expects\n            return new Response(JSON.stringify({\n                error: \"not_a_job\",\n                message: \"This content doesn't look like a valid job description.\"\n            }), {\n                headers: { ...corsHeaders, 'Content-Type': 'application/json' },\n                status: 400,\n            });\n        }\n\n        // 7. TRACK USAGE (Tokens only, as analysis was already incremented)\n        const totalTokens = (data.usageMetadata?.totalTokenCount) || 0;\n        if (totalTokens > 0) {\n            const { error: usageError } = await supabase.rpc('track_usage', {\n                p_tokens: totalTokens,\n                p_is_analysis: false // Always false here as we handled it pessimistically\n            });\n            if (usageError) console.error(\"Usage tracking error:\", sanitizeLog(usageError));\n        }\n\n        return new Response(JSON.stringify({ text, usage: data.usageMetadata }), {\n            headers: { ...corsHeaders, 'Content-Type': 'application/json' },\n            status: 200,\n        })\n\n    } catch (error: unknown) {\n        const message = error instanceof Error ? error.message : String(error);\n        console.error(\"Gemini Proxy Error:\", sanitizeLog(message));\n        return new Response(JSON.stringify({ error: `Edge Function Error: ${message}` }), {\n            headers: { ...corsHeaders, 'Content-Type': 'application/json' },\n            status: 500, // Correctly return an error status code\n        })\n    }\n}\n\nDeno.serve(handler)\n","usedDeprecatedRules":[]},{"filePath":"/Users/ryan/Desktop/Coding/Production/Navigator/supabase/functions/gemini-proxy/test/sanitize_log.test.ts","messages":[{"ruleId":"no-control-regex","severity":2,"message":"Unexpected control character(s) in regular expression: \\x08, \\x09, \\x1a, \\x1b.","line":7,"column":37,"nodeType":"Literal","messageId":"unexpected","endLine":7,"endColumn":66}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport { describe, it, expect } from 'vitest';\n\n// Simulate the fixed implementation\nconst MAX_LOG_LENGTH = 200;\nconst sanitizeLog = (val: unknown) => {\n    const str = String(val).replace(/[\\n\\r\\t\\0\\x08\\x09\\x1a\\x1b]/g, ' ');\n    return str.length > MAX_LOG_LENGTH ? str.substring(0, MAX_LOG_LENGTH) + '...' : str;\n};\n\ndescribe('Gemini Proxy Security Fix Verification', () => {\n\n    it('should sanitize newlines in logs', () => {\n        const input = \"Hello\\nWorld\\rTest\";\n        const sanitized = sanitizeLog(input);\n        expect(sanitized).toBe(\"Hello World Test\");\n    });\n\n    it('should sanitize tabs and other control characters', () => {\n        const input = \"Hello\\tWorld\\0Test\\x08Back\";\n        const sanitized = sanitizeLog(input);\n        expect(sanitized).toBe(\"Hello World Test Back\");\n    });\n\n    it('should truncate long strings (Fix Verified)', () => {\n        const longString = \"A\".repeat(1000);\n        const sanitized = sanitizeLog(longString);\n        expect(sanitized.length).toBe(MAX_LOG_LENGTH + 3); // 200 + '...'\n        expect(sanitized.endsWith('...')).toBe(true);\n    });\n\n    it('should not truncate short strings', () => {\n        const shortString = \"Short string\";\n        const sanitized = sanitizeLog(shortString);\n        expect(sanitized).toBe(\"Short string\");\n    });\n});\n","usedDeprecatedRules":[]}]
